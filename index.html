<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Sekolah Digital - SMK Teknologi Maju</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .pulse-ring {
            animation: pulse-ring 1.5s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }
        @keyframes pulse-ring {
            0% { transform: scale(0.33); }
            80%, 100% { opacity: 0; }
        }
        .timer-warning {
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-lg border-b-4 border-blue-500">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold text-lg">üè´</span>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900">Sistem Sekolah Digital</h1>
                        <p class="text-sm text-gray-600">SMK Teknologi Maju</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <span id="currentTime" class="text-sm text-gray-600"></span>
                    <button onclick="showLogin()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                        Login Admin
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Login Modal -->
        <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
            <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 fade-in">
                <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center">Login Admin</h2>
                <form onsubmit="handleLogin(event)">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Username</label>
                        <input type="text" id="username" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Masukkan username" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Password</label>
                        <input type="password" id="password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Masukkan password" required>
                    </div>
                    <div class="flex space-x-3">
                        <button type="button" onclick="hideLogin()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-3 rounded-lg transition-colors">
                            Batal
                        </button>
                        <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg transition-colors">
                            Login
                        </button>
                    </div>
                </form>
                <p class="text-xs text-gray-500 mt-4 text-center">Demo: admin / admin123</p>
            </div>
        </div>

        <!-- Public Section -->
        <div id="publicSection" class="space-y-8">
            <!-- Main Menu -->
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center">Pilih Layanan</h2>
                <div class="grid md:grid-cols-2 gap-6">
                    <button onclick="showAttendanceMenu()" class="service-card bg-gradient-to-br from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white p-8 rounded-xl transition-all transform hover:scale-105">
                        <div class="text-5xl mb-4">üìù</div>
                        <h3 class="text-2xl font-bold mb-3">Sistem Absensi</h3>
                        <p class="text-green-100">Absensi untuk guru, karyawan, dan siswa</p>
                    </button>
                    <button onclick="showExamMenu()" class="service-card bg-gradient-to-br from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white p-8 rounded-xl transition-all transform hover:scale-105">
                        <div class="text-5xl mb-4">üìö</div>
                        <h3 class="text-2xl font-bold mb-3">Ujian Online</h3>
                        <p class="text-purple-100">Sistem ujian digital untuk siswa</p>
                    </button>
                </div>
            </div>

            <!-- Attendance Menu -->
            <div id="attendanceMenu" class="bg-white rounded-xl shadow-lg p-8 hidden">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">Pilih Jenis Absensi</h2>
                    <button onclick="backToMainMenu()" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                <div class="grid md:grid-cols-3 gap-6">
                    <button onclick="selectRole('guru')" class="role-card bg-gradient-to-br from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white p-6 rounded-xl transition-all transform hover:scale-105">
                        <div class="text-4xl mb-3">üë®‚Äçüè´</div>
                        <h3 class="text-xl font-bold mb-2">Guru</h3>
                        <p class="text-green-100">Absensi untuk tenaga pengajar</p>
                    </button>
                    <button onclick="selectRole('karyawan')" class="role-card bg-gradient-to-br from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white p-6 rounded-xl transition-all transform hover:scale-105">
                        <div class="text-4xl mb-3">üë®‚Äçüíº</div>
                        <h3 class="text-xl font-bold mb-2">Karyawan</h3>
                        <p class="text-blue-100">Absensi untuk staff sekolah</p>
                    </button>
                    <button onclick="selectRole('siswa')" class="role-card bg-gradient-to-br from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white p-6 rounded-xl transition-all transform hover:scale-105">
                        <div class="text-4xl mb-3">üë®‚Äçüéì</div>
                        <h3 class="text-xl font-bold mb-2">Siswa</h3>
                        <p class="text-purple-100">Absensi untuk peserta didik</p>
                    </button>
                </div>
            </div>

            <!-- Exam Menu -->
            <div id="examMenu" class="bg-white rounded-xl shadow-lg p-8 hidden">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">Ujian Online</h2>
                    <button onclick="backToMainMenu()" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <!-- Student Login for Exam -->
                <div class="max-w-md mx-auto">
                    <form onsubmit="handleStudentLogin(event)" class="space-y-4">
                        <div>
                            <label class="block text-gray-700 text-sm font-medium mb-2">NIS Siswa</label>
                            <input type="text" id="studentNIS" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Masukkan NIS" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-medium mb-2">Nama Lengkap</label>
                            <input type="text" id="studentName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Masukkan nama lengkap" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-medium mb-2">Kelas</label>
                            <select id="studentClass" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" required>
                                <option value="">Pilih Kelas</option>
                                <option value="X RPL 1">X RPL 1</option>
                                <option value="X RPL 2">X RPL 2</option>
                                <option value="XI RPL 1">XI RPL 1</option>
                                <option value="XI RPL 2">XI RPL 2</option>
                                <option value="XII RPL 1">XII RPL 1</option>
                                <option value="XII RPL 2">XII RPL 2</option>
                            </select>
                        </div>
                        <button type="submit" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-3 rounded-lg transition-colors">
                            Masuk ke Ujian
                        </button>
                    </form>
                </div>
            </div>

            <!-- Available Exams -->
            <div id="examList" class="bg-white rounded-xl shadow-lg p-8 hidden">
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">Ujian Tersedia</h2>
                        <p class="text-gray-600">Selamat datang, <span id="welcomeStudent"></span></p>
                    </div>
                    <button onclick="logoutStudent()" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                        </svg>
                    </button>
                </div>
                
                <div class="grid md:grid-cols-2 gap-6" id="examCards">
                    <!-- Exam cards will be populated here -->
                </div>
            </div>

            <!-- Exam Interface -->
            <div id="examInterface" class="bg-white rounded-xl shadow-lg p-8 hidden">
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900" id="examTitle"></h2>
                        <p class="text-gray-600" id="examInfo"></p>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-bold text-red-600" id="examTimer">00:00</div>
                        <p class="text-sm text-gray-600">Waktu tersisa</p>
                    </div>
                </div>
                
                <div class="mb-6">
                    <div class="bg-gray-200 rounded-full h-2">
                        <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" id="progressBar" style="width: 0%"></div>
                    </div>
                    <p class="text-sm text-gray-600 mt-2">Soal <span id="currentQuestion">1</span> dari <span id="totalQuestions">10</span></p>
                </div>
                
                <div id="questionContainer" class="mb-8">
                    <!-- Questions will be populated here -->
                </div>
                
                <div class="flex justify-between">
                    <button onclick="previousQuestion()" id="prevBtn" class="bg-gray-300 hover:bg-gray-400 text-gray-700 px-6 py-3 rounded-lg transition-colors disabled:opacity-50" disabled>
                        ‚Üê Sebelumnya
                    </button>
                    <button onclick="nextQuestion()" id="nextBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-colors">
                        Selanjutnya ‚Üí
                    </button>
                    <button onclick="finishExam()" id="finishBtn" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg transition-colors hidden">
                        Selesai Ujian
                    </button>
                </div>
            </div>

            <!-- Exam Result -->
            <div id="examResult" class="bg-white rounded-xl shadow-lg p-8 hidden">
                <div class="text-center">
                    <div class="text-6xl mb-4">üéâ</div>
                    <h2 class="text-3xl font-bold text-gray-900 mb-4">Ujian Selesai!</h2>
                    <div class="bg-gray-50 rounded-lg p-6 mb-6">
                        <div class="grid md:grid-cols-3 gap-4 text-center">
                            <div>
                                <p class="text-2xl font-bold text-blue-600" id="finalScore">0</p>
                                <p class="text-gray-600">Nilai</p>
                            </div>
                            <div>
                                <p class="text-2xl font-bold text-green-600" id="correctAnswers">0</p>
                                <p class="text-gray-600">Benar</p>
                            </div>
                            <div>
                                <p class="text-2xl font-bold text-red-600" id="wrongAnswers">0</p>
                                <p class="text-gray-600">Salah</p>
                            </div>
                        </div>
                    </div>
                    <button onclick="backToExamList()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg transition-colors">
                        Kembali ke Daftar Ujian
                    </button>
                </div>
            </div>

            <!-- Attendance Form (existing code) -->
            <div id="attendanceForm" class="bg-white rounded-xl shadow-lg p-8 hidden">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">Absensi <span id="selectedRoleTitle"></span></h2>
                    <button onclick="backToAttendanceMenu()" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <form onsubmit="handleAttendance(event)" class="space-y-6">
                    <div class="grid md:grid-cols-3 gap-6">
                        <div>
                            <label class="block text-gray-700 text-sm font-medium mb-2">Nama Lengkap</label>
                            <input type="text" id="fullName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Masukkan nama lengkap" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-medium mb-2">NIP/NIS</label>
                            <input type="text" id="idNumber" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Masukkan NIP/NIS" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-medium mb-2">Jenis Absensi</label>
                            <select id="attendanceType" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required onchange="checkAttendanceTime()">
                                <option value="">Pilih Jenis Absensi</option>
                                <option value="masuk">Absen Masuk</option>
                                <option value="pulang">Absen Pulang</option>
                            </select>
                        </div>
                    </div>

                    <!-- Time Warning -->
                    <div id="timeWarning" class="hidden bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <div class="flex items-start space-x-3">
                            <span class="text-yellow-600 text-xl">‚ö†Ô∏è</span>
                            <div>
                                <h4 class="font-medium text-yellow-800 mb-1">Peringatan Waktu</h4>
                                <p id="timeWarningText" class="text-sm text-yellow-700"></p>
                            </div>
                        </div>
                    </div>

                    <div id="siswaFields" class="hidden">
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-gray-700 text-sm font-medium mb-2">Kelas</label>
                                <select id="kelas" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="">Pilih Kelas</option>
                                    <option value="X RPL 1">X RPL 1</option>
                                    <option value="X RPL 2">X RPL 2</option>
                                    <option value="XI RPL 1">XI RPL 1</option>
                                    <option value="XI RPL 2">XI RPL 2</option>
                                    <option value="XII RPL 1">XII RPL 1</option>
                                    <option value="XII RPL 2">XII RPL 2</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 text-sm font-medium mb-2">Jurusan</label>
                                <select id="jurusan" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="">Pilih Jurusan</option>
                                    <option value="RPL">Rekayasa Perangkat Lunak</option>
                                    <option value="TKJ">Teknik Komputer Jaringan</option>
                                    <option value="MM">Multimedia</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Camera Section -->
                    <div class="bg-gray-50 rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">üì∏ Foto Absensi</h3>
                        <div class="flex flex-col items-center space-y-4">
                            <video id="camera" class="w-full max-w-md rounded-lg shadow-lg hidden" autoplay></video>
                            <canvas id="photoCanvas" class="w-full max-w-md rounded-lg shadow-lg hidden"></canvas>
                            <img id="capturedPhoto" class="w-full max-w-md rounded-lg shadow-lg hidden" alt="Foto yang diambil">
                            
                            <div class="flex flex-wrap gap-3 justify-center">
                                <button type="button" id="startCameraBtn" onclick="startCamera()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-colors inline-flex items-center space-x-2">
                                    <span>üì∑</span>
                                    <span>Buka Kamera</span>
                                </button>
                                <button type="button" id="captureBtn" onclick="capturePhoto()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg transition-colors hidden inline-flex items-center space-x-2">
                                    <span>üì∏</span>
                                    <span>Ambil Foto</span>
                                </button>
                                <button type="button" id="retakeBtn" onclick="retakePhoto()" class="bg-yellow-600 hover:bg-yellow-700 text-white px-6 py-3 rounded-lg transition-colors hidden inline-flex items-center space-x-2">
                                    <span>üîÑ</span>
                                    <span>Foto Ulang</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- GPS Section -->
                    <div class="bg-gray-50 rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">üìç Lokasi GPS</h3>
                        
                        <!-- Location Permission Guide -->
                        <div id="locationGuide" class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                            <h4 class="font-medium text-blue-900 mb-2">üí° Cara Mengizinkan Akses Lokasi:</h4>
                            <div class="text-sm text-blue-800 space-y-1">
                                <p>1. Klik tombol "Dapatkan Lokasi" di bawah</p>
                                <p>2. Browser akan menampilkan popup izin lokasi</p>
                                <p>3. Klik "Allow" atau "Izinkan" pada popup tersebut</p>
                                <p>4. Jika tidak muncul popup, cek ikon üîí di address bar browser</p>
                            </div>
                        </div>
                        
                        <div class="flex items-start justify-between gap-4">
                            <div class="flex-1">
                                <p id="locationStatus" class="text-gray-600">Klik tombol untuk mendapatkan lokasi</p>
                                <p id="locationCoords" class="text-sm text-gray-500 mt-1 hidden"></p>
                                
                                <!-- Manual Location Input -->
                                <div id="manualLocationDiv" class="hidden mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                                    <h5 class="font-medium text-yellow-800 mb-2">üìù Input Lokasi Manual</h5>
                                    <p class="text-sm text-yellow-700 mb-3">Jika GPS tidak bisa diakses, masukkan lokasi secara manual:</p>
                                    <input type="text" id="manualLocation" placeholder="Contoh: Ruang Guru, Lantai 2" class="w-full px-3 py-2 border border-yellow-300 rounded-lg focus:ring-2 focus:ring-yellow-500 text-sm">
                                    <button type="button" onclick="useManualLocation()" class="mt-2 bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                                        Gunakan Lokasi Manual
                                    </button>
                                </div>
                            </div>
                            <div class="flex flex-col space-y-2">
                                <button type="button" id="getLocationBtn" onclick="getLocation()" class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg transition-colors inline-flex items-center space-x-2">
                                    <span>üìç</span>
                                    <span>Dapatkan Lokasi</span>
                                </button>
                                <button type="button" id="manualLocationBtn" onclick="showManualLocation()" class="bg-yellow-600 hover:bg-yellow-700 text-white px-6 py-3 rounded-lg transition-colors inline-flex items-center space-x-2 text-sm">
                                    <span>üìù</span>
                                    <span>Input Manual</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="flex space-x-4">
                        <button type="button" onclick="backToAttendanceMenu()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-3 rounded-lg transition-colors">
                            Kembali
                        </button>
                        <button type="submit" id="submitBtn" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg transition-colors disabled:bg-gray-400" disabled>
                            Kirim Absensi
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Admin Dashboard -->
        <div id="adminDashboard" class="hidden space-y-8">
            <div class="flex justify-between items-center">
                <h2 class="text-3xl font-bold text-gray-900">Dashboard Admin</h2>
                <div class="flex space-x-4">
                    <button onclick="showAdminExams()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors">
                        Kelola Ujian
                    </button>
                    <button onclick="logout()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors">
                        Logout
                    </button>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="grid md:grid-cols-5 gap-6">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Total Absensi Hari Ini</p>
                            <p class="text-3xl font-bold text-blue-600" id="totalToday">0</p>
                        </div>
                        <div class="text-4xl">üìä</div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Guru Hadir</p>
                            <p class="text-3xl font-bold text-green-600" id="guruHadir">0</p>
                        </div>
                        <div class="text-4xl">üë®‚Äçüè´</div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Karyawan Hadir</p>
                            <p class="text-3xl font-bold text-blue-600" id="karyawanHadir">0</p>
                        </div>
                        <div class="text-4xl">üë®‚Äçüíº</div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Siswa Hadir</p>
                            <p class="text-3xl font-bold text-purple-600" id="siswaHadir">0</p>
                        </div>
                        <div class="text-4xl">üë®‚Äçüéì</div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Ujian Aktif</p>
                            <p class="text-3xl font-bold text-orange-600" id="activeExams">0</p>
                        </div>
                        <div class="text-4xl">üìù</div>
                    </div>
                </div>
            </div>

            <!-- Attendance Data Table (existing) -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex flex-wrap items-center justify-between gap-4 mb-6">
                    <div class="flex items-center space-x-4">
                        <h3 class="text-xl font-bold text-gray-900">Data Absensi</h3>
                        <span class="text-sm text-gray-500" id="lastUpdate">Terakhir diperbarui: -</span>
                    </div>
                    <div class="flex flex-wrap items-center gap-4">
                        <button onclick="refreshData()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center space-x-2">
                            <span>üîÑ</span>
                            <span>Refresh</span>
                        </button>
                        <select id="filterRole" onchange="filterData()" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="">Semua Role</option>
                            <option value="guru">Guru</option>
                            <option value="karyawan">Karyawan</option>
                            <option value="siswa">Siswa</option>
                        </select>
                        <select id="filterType" onchange="filterData()" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="">Semua Jenis</option>
                            <option value="masuk">Absen Masuk</option>
                            <option value="pulang">Absen Pulang</option>
                        </select>
                        <div class="flex items-center space-x-2">
                            <label class="text-sm text-gray-600">Dari:</label>
                            <input type="date" id="filterDateFrom" onchange="filterData()" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm">
                        </div>
                        <div class="flex items-center space-x-2">
                            <label class="text-sm text-gray-600">Sampai:</label>
                            <input type="date" id="filterDateTo" onchange="filterData()" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm">
                        </div>
                        <button onclick="resetFilters()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors flex items-center space-x-2 text-sm">
                            <span>üîÑ</span>
                            <span>Reset Filter</span>
                        </button>
                        <button onclick="exportToCSV()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center space-x-2">
                            <span>üì•</span>
                            <span>Export CSV</span>
                        </button>
                        <button onclick="exportToExcel()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center space-x-2">
                            <span>üìä</span>
                            <span>Export Excel</span>
                        </button>
                    </div>
                </div>

                <div class="overflow-x-auto">
                    <table class="w-full table-auto">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Waktu</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Nama</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Role</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Jenis</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Status</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">NIP/NIS</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Kelas/Jurusan</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Lokasi</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Foto</th>
                            </tr>
                        </thead>
                        <tbody id="attendanceTable" class="divide-y divide-gray-200">
                            <!-- Data will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Exam Management -->
            <div id="examManagement" class="bg-white rounded-xl shadow-lg p-6 hidden">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-bold text-gray-900">Kelola Ujian</h3>
                    <div class="flex space-x-4">
                        <button onclick="showCreateExam()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors">
                            Buat Ujian Baru
                        </button>
                        <button onclick="hideAdminExams()" class="bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded-lg transition-colors">
                            Kembali
                        </button>
                    </div>
                </div>

                <div class="overflow-x-auto">
                    <table class="w-full table-auto">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Mata Pelajaran</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Kelas</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Durasi</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Soal</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Status</th>
                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="examManagementTable" class="divide-y divide-gray-200">
                            <!-- Data will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Create Exam Form -->
            <div id="createExamForm" class="bg-white rounded-xl shadow-lg p-6 hidden">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-bold text-gray-900">Buat Ujian Baru</h3>
                    <button onclick="hideCreateExam()" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <form onsubmit="createExam(event)" class="space-y-6">
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-700 text-sm font-medium mb-2">Mata Pelajaran</label>
                            <input type="text" id="examSubject" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Contoh: Matematika" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-medium mb-2">Kelas</label>
                            <select id="examClass" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" required>
                                <option value="">Pilih Kelas</option>
                                <option value="X RPL 1">X RPL 1</option>
                                <option value="X RPL 2">X RPL 2</option>
                                <option value="XI RPL 1">XI RPL 1</option>
                                <option value="XI RPL 2">XI RPL 2</option>
                                <option value="XII RPL 1">XII RPL 1</option>
                                <option value="XII RPL 2">XII RPL 2</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-700 text-sm font-medium mb-2">Durasi (menit)</label>
                            <input type="number" id="examDuration" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="60" min="1" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-medium mb-2">Jumlah Soal</label>
                            <input type="number" id="examQuestionCount" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="10" min="1" max="50" required>
                        </div>
                    </div>

                    <div>
                        <label class="block text-gray-700 text-sm font-medium mb-2">Deskripsi</label>
                        <textarea id="examDescription" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" rows="3" placeholder="Deskripsi ujian..."></textarea>
                    </div>

                    <div class="flex space-x-4">
                        <button type="button" onclick="hideCreateExam()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-3 rounded-lg transition-colors">
                            Batal
                        </button>
                        <button type="submit" class="flex-1 bg-purple-600 hover:bg-purple-700 text-white py-3 rounded-lg transition-colors">
                            Buat Ujian
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <script>
        // Global variables
        let currentRole = '';
        let attendanceData = JSON.parse(localStorage.getItem('attendanceData')) || [];
        let examData = JSON.parse(localStorage.getItem('examData')) || [];
        let examResults = JSON.parse(localStorage.getItem('examResults')) || [];
        let currentStream = null;
        let hasPhoto = false;
        let hasLocation = false;
        
        // Exam variables
        let currentStudent = null;
        let currentExam = null;
        let currentQuestionIndex = 0;
        let studentAnswers = [];
        let examTimer = null;
        let examTimeLeft = 0;

        // Sample exam data
        if (examData.length === 0) {
            examData = [
                {
                    id: 1,
                    subject: 'Matematika',
                    class: 'X RPL 1',
                    duration: 60,
                    description: 'Ujian Matematika Semester 1',
                    status: 'active',
                    questions: [
                        {
                            question: 'Berapakah hasil dari 2 + 2?',
                            options: ['3', '4', '5', '6'],
                            correct: 1
                        },
                        {
                            question: 'Berapakah hasil dari 5 √ó 3?',
                            options: ['12', '15', '18', '20'],
                            correct: 1
                        },
                        {
                            question: 'Berapakah hasil dari 10 √∑ 2?',
                            options: ['3', '4', '5', '6'],
                            correct: 2
                        },
                        {
                            question: 'Berapakah hasil dari 8 - 3?',
                            options: ['4', '5', '6', '7'],
                            correct: 1
                        },
                        {
                            question: 'Berapakah hasil dari 3¬≤?',
                            options: ['6', '8', '9', '12'],
                            correct: 2
                        }
                    ]
                },
                {
                    id: 2,
                    subject: 'Bahasa Indonesia',
                    class: 'XI RPL 1',
                    duration: 45,
                    description: 'Ujian Bahasa Indonesia - Teks Eksposisi',
                    status: 'active',
                    questions: [
                        {
                            question: 'Apa yang dimaksud dengan teks eksposisi?',
                            options: ['Teks yang berisi cerita', 'Teks yang berisi informasi', 'Teks yang berisi puisi', 'Teks yang berisi dialog'],
                            correct: 1
                        },
                        {
                            question: 'Struktur teks eksposisi terdiri dari?',
                            options: ['Orientasi-Komplikasi-Resolusi', 'Tesis-Argumentasi-Penegasan', 'Pembuka-Isi-Penutup', 'Judul-Isi-Kesimpulan'],
                            correct: 1
                        }
                    ]
                }
            ];
            localStorage.setItem('examData', JSON.stringify(examData));
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateTime();
            setInterval(updateTime, 1000);
            
            // Load data from localStorage on page load
            attendanceData = JSON.parse(localStorage.getItem('attendanceData')) || [];
            examData = JSON.parse(localStorage.getItem('examData')) || [];
            examResults = JSON.parse(localStorage.getItem('examResults')) || [];
            
            updateStats();
            renderAttendanceTable();
            
            // Set today's date as default filter
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('filterDateFrom').value = today;
            document.getElementById('filterDateTo').value = today;
            
            // Auto-refresh data every 30 seconds if admin is logged in
            setInterval(() => {
                if (!document.getElementById('adminDashboard').classList.contains('hidden')) {
                    // Reload data from localStorage
                    attendanceData = JSON.parse(localStorage.getItem('attendanceData')) || [];
                    examData = JSON.parse(localStorage.getItem('examData')) || [];
                    examResults = JSON.parse(localStorage.getItem('examResults')) || [];
                    
                    updateStats();
                    renderAttendanceTable();
                }
            }, 30000); // Refresh every 30 seconds
        });

        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleString('id-ID', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('currentTime').textContent = timeString;
        }

        // Navigation functions
        function showLogin() {
            document.getElementById('loginModal').classList.remove('hidden');
        }

        function hideLogin() {
            document.getElementById('loginModal').classList.add('hidden');
        }

        function showAttendanceMenu() {
            document.querySelector('.grid.md\\:grid-cols-2').parentElement.classList.add('hidden');
            document.getElementById('attendanceMenu').classList.remove('hidden');
        }

        function showExamMenu() {
            document.querySelector('.grid.md\\:grid-cols-2').parentElement.classList.add('hidden');
            document.getElementById('examMenu').classList.remove('hidden');
        }

        function backToMainMenu() {
            // Hide all sections
            document.getElementById('attendanceMenu').classList.add('hidden');
            document.getElementById('examMenu').classList.add('hidden');
            document.getElementById('examList').classList.add('hidden');
            document.getElementById('attendanceForm').classList.add('hidden');
            
            // Show main menu
            document.querySelector('.grid.md\\:grid-cols-2').parentElement.classList.remove('hidden');
            
            // Reset forms
            resetForm();
            currentStudent = null;
        }

        function backToAttendanceMenu() {
            document.getElementById('attendanceForm').classList.add('hidden');
            document.getElementById('attendanceMenu').classList.remove('hidden');
            stopCamera();
            resetForm();
        }

        // Login functions
        function handleLogin(event) {
            event.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === 'admin' && password === 'admin123') {
                hideLogin();
                document.getElementById('publicSection').classList.add('hidden');
                document.getElementById('adminDashboard').classList.remove('hidden');
                
                // Reload all data from localStorage to ensure fresh data
                attendanceData = JSON.parse(localStorage.getItem('attendanceData')) || [];
                examData = JSON.parse(localStorage.getItem('examData')) || [];
                examResults = JSON.parse(localStorage.getItem('examResults')) || [];
                
                // Update dashboard
                updateStats();
                renderAttendanceTable();
                renderExamManagementTable();
                
                // Clear login form
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                
                console.log('Admin logged in. Data loaded:', {
                    attendance: attendanceData.length,
                    exams: examData.length,
                    results: examResults.length
                });
            } else {
                alert('Username atau password salah!');
            }
        }

        function logout() {
            document.getElementById('adminDashboard').classList.add('hidden');
            document.getElementById('publicSection').classList.remove('hidden');
            document.getElementById('examManagement').classList.add('hidden');
            document.getElementById('createExamForm').classList.add('hidden');
            backToMainMenu();
        }

        // Student exam login
        function handleStudentLogin(event) {
            event.preventDefault();
            const nis = document.getElementById('studentNIS').value;
            const name = document.getElementById('studentName').value;
            const studentClass = document.getElementById('studentClass').value;
            
            currentStudent = {
                nis: nis,
                name: name,
                class: studentClass
            };
            
            document.getElementById('examMenu').classList.add('hidden');
            document.getElementById('examList').classList.remove('hidden');
            document.getElementById('welcomeStudent').textContent = name;
            
            renderExamList();
        }

        function logoutStudent() {
            currentStudent = null;
            document.getElementById('examList').classList.add('hidden');
            document.getElementById('examMenu').classList.remove('hidden');
            
            // Reset form
            document.getElementById('studentNIS').value = '';
            document.getElementById('studentName').value = '';
            document.getElementById('studentClass').value = '';
        }

        // Exam functions
        function renderExamList() {
            const container = document.getElementById('examCards');
            const availableExams = examData.filter(exam => 
                exam.status === 'active' && 
                (exam.class === currentStudent.class || exam.class === 'Semua Kelas')
            );
            
            container.innerHTML = '';
            
            availableExams.forEach(exam => {
                const card = document.createElement('div');
                card.className = 'bg-gradient-to-br from-purple-500 to-purple-600 text-white p-6 rounded-xl cursor-pointer hover:from-purple-600 hover:to-purple-700 transition-all transform hover:scale-105';
                card.onclick = () => startExam(exam.id);
                
                card.innerHTML = `
                    <div class="text-3xl mb-3">üìù</div>
                    <h3 class="text-xl font-bold mb-2">${exam.subject}</h3>
                    <p class="text-purple-100 mb-4">${exam.description}</p>
                    <div class="flex justify-between text-sm text-purple-200">
                        <span>‚è±Ô∏è ${exam.duration} menit</span>
                        <span>üìã ${exam.questions.length} soal</span>
                    </div>
                `;
                
                container.appendChild(card);
            });
            
            if (availableExams.length === 0) {
                container.innerHTML = '<div class="col-span-2 text-center text-gray-500 py-8">Tidak ada ujian tersedia untuk kelas Anda</div>';
            }
        }

        function startExam(examId) {
            currentExam = examData.find(exam => exam.id === examId);
            if (!currentExam) return;
            
            currentQuestionIndex = 0;
            studentAnswers = new Array(currentExam.questions.length).fill(null);
            examTimeLeft = currentExam.duration * 60; // Convert to seconds
            
            document.getElementById('examList').classList.add('hidden');
            document.getElementById('examInterface').classList.remove('hidden');
            
            document.getElementById('examTitle').textContent = currentExam.subject;
            document.getElementById('examInfo').textContent = `${currentExam.description} - ${currentExam.questions.length} soal`;
            document.getElementById('totalQuestions').textContent = currentExam.questions.length;
            
            startExamTimer();
            showQuestion();
        }

        function startExamTimer() {
            examTimer = setInterval(() => {
                examTimeLeft--;
                updateTimerDisplay();
                
                if (examTimeLeft <= 0) {
                    clearInterval(examTimer);
                    finishExam();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(examTimeLeft / 60);
            const seconds = examTimeLeft % 60;
            const timerElement = document.getElementById('examTimer');
            
            timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Add warning class when time is running low
            if (examTimeLeft <= 300) { // 5 minutes
                timerElement.classList.add('timer-warning');
            }
        }

        function showQuestion() {
            const question = currentExam.questions[currentQuestionIndex];
            const container = document.getElementById('questionContainer');
            
            container.innerHTML = `
                <div class="bg-gray-50 rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">
                        ${currentQuestionIndex + 1}. ${question.question}
                    </h3>
                    <div class="space-y-3">
                        ${question.options.map((option, index) => `
                            <label class="flex items-center space-x-3 cursor-pointer p-3 rounded-lg hover:bg-white transition-colors">
                                <input type="radio" name="answer" value="${index}" 
                                       ${studentAnswers[currentQuestionIndex] === index ? 'checked' : ''}
                                       onchange="saveAnswer(${index})" 
                                       class="w-4 h-4 text-purple-600 focus:ring-purple-500">
                                <span class="text-gray-700">${String.fromCharCode(65 + index)}. ${option}</span>
                            </label>
                        `).join('')}
                    </div>
                </div>
            `;
            
            // Update progress
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            const progress = ((currentQuestionIndex + 1) / currentExam.questions.length) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
            
            // Update navigation buttons
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            if (currentQuestionIndex === currentExam.questions.length - 1) {
                document.getElementById('nextBtn').classList.add('hidden');
                document.getElementById('finishBtn').classList.remove('hidden');
            } else {
                document.getElementById('nextBtn').classList.remove('hidden');
                document.getElementById('finishBtn').classList.add('hidden');
            }
        }

        function saveAnswer(answerIndex) {
            studentAnswers[currentQuestionIndex] = answerIndex;
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion();
            }
        }

        function nextQuestion() {
            if (currentQuestionIndex < currentExam.questions.length - 1) {
                currentQuestionIndex++;
                showQuestion();
            }
        }

        function finishExam() {
            clearInterval(examTimer);
            
            // Calculate score
            let correctAnswers = 0;
            currentExam.questions.forEach((question, index) => {
                if (studentAnswers[index] === question.correct) {
                    correctAnswers++;
                }
            });
            
            const totalQuestions = currentExam.questions.length;
            const score = Math.round((correctAnswers / totalQuestions) * 100);
            
            // Save result
            const result = {
                id: Date.now(),
                studentNIS: currentStudent.nis,
                studentName: currentStudent.name,
                studentClass: currentStudent.class,
                examId: currentExam.id,
                examSubject: currentExam.subject,
                score: score,
                correctAnswers: correctAnswers,
                totalQuestions: totalQuestions,
                answers: studentAnswers,
                timestamp: new Date().toISOString(),
                date: new Date().toISOString().split('T')[0]
            };
            
            examResults.push(result);
            localStorage.setItem('examResults', JSON.stringify(examResults));
            
            // Show result
            document.getElementById('examInterface').classList.add('hidden');
            document.getElementById('examResult').classList.remove('hidden');
            
            document.getElementById('finalScore').textContent = score;
            document.getElementById('correctAnswers').textContent = correctAnswers;
            document.getElementById('wrongAnswers').textContent = totalQuestions - correctAnswers;
        }

        function backToExamList() {
            document.getElementById('examResult').classList.add('hidden');
            document.getElementById('examList').classList.remove('hidden');
            
            // Reset exam state
            currentExam = null;
            currentQuestionIndex = 0;
            studentAnswers = [];
            examTimeLeft = 0;
            
            // Reset timer display
            document.getElementById('examTimer').classList.remove('timer-warning');
        }

        // Admin exam management
        function showAdminExams() {
            document.getElementById('examManagement').classList.remove('hidden');
            renderExamManagementTable();
        }

        function hideAdminExams() {
            document.getElementById('examManagement').classList.add('hidden');
            document.getElementById('createExamForm').classList.add('hidden');
        }

        function showCreateExam() {
            document.getElementById('createExamForm').classList.remove('hidden');
        }

        function hideCreateExam() {
            document.getElementById('createExamForm').classList.add('hidden');
            
            // Reset form
            document.getElementById('examSubject').value = '';
            document.getElementById('examClass').value = '';
            document.getElementById('examDuration').value = '';
            document.getElementById('examQuestionCount').value = '';
            document.getElementById('examDescription').value = '';
        }

        function createExam(event) {
            event.preventDefault();
            
            const subject = document.getElementById('examSubject').value;
            const examClass = document.getElementById('examClass').value;
            const duration = parseInt(document.getElementById('examDuration').value);
            const questionCount = parseInt(document.getElementById('examQuestionCount').value);
            const description = document.getElementById('examDescription').value;
            
            // Generate sample questions (in real app, this would be a proper question builder)
            const questions = [];
            for (let i = 0; i < questionCount; i++) {
                questions.push({
                    question: `Soal ${i + 1} untuk ${subject}`,
                    options: ['Pilihan A', 'Pilihan B', 'Pilihan C', 'Pilihan D'],
                    correct: 0 // Default correct answer
                });
            }
            
            const newExam = {
                id: Date.now(),
                subject: subject,
                class: examClass,
                duration: duration,
                description: description,
                status: 'active',
                questions: questions
            };
            
            examData.push(newExam);
            localStorage.setItem('examData', JSON.stringify(examData));
            
            alert('Ujian berhasil dibuat!');
            hideCreateExam();
            renderExamManagementTable();
            updateStats();
        }

        function renderExamManagementTable() {
            const tbody = document.getElementById('examManagementTable');
            tbody.innerHTML = '';
            
            examData.forEach(exam => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                
                row.innerHTML = `
                    <td class="px-4 py-3 text-sm font-medium text-gray-900">${exam.subject}</td>
                    <td class="px-4 py-3 text-sm text-gray-900">${exam.class}</td>
                    <td class="px-4 py-3 text-sm text-gray-900">${exam.duration} menit</td>
                    <td class="px-4 py-3 text-sm text-gray-900">${exam.questions.length} soal</td>
                    <td class="px-4 py-3">
                        <span class="px-2 py-1 text-xs font-medium rounded-full ${exam.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                            ${exam.status === 'active' ? 'Aktif' : 'Nonaktif'}
                        </span>
                    </td>
                    <td class="px-4 py-3">
                        <button onclick="toggleExamStatus(${exam.id})" class="text-blue-600 hover:text-blue-800 text-sm mr-3">
                            ${exam.status === 'active' ? 'Nonaktifkan' : 'Aktifkan'}
                        </button>
                        <button onclick="deleteExam(${exam.id})" class="text-red-600 hover:text-red-800 text-sm">
                            Hapus
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function toggleExamStatus(examId) {
            const exam = examData.find(e => e.id === examId);
            if (exam) {
                exam.status = exam.status === 'active' ? 'inactive' : 'active';
                localStorage.setItem('examData', JSON.stringify(examData));
                renderExamManagementTable();
                updateStats();
            }
        }

        function deleteExam(examId) {
            if (confirm('Apakah Anda yakin ingin menghapus ujian ini?')) {
                examData = examData.filter(e => e.id !== examId);
                localStorage.setItem('examData', JSON.stringify(examData));
                renderExamManagementTable();
                updateStats();
            }
        }

        // Attendance functions (existing code)
        function selectRole(role) {
            currentRole = role;
            document.getElementById('selectedRoleTitle').textContent = role.charAt(0).toUpperCase() + role.slice(1);
            document.getElementById('attendanceMenu').classList.add('hidden');
            document.getElementById('attendanceForm').classList.remove('hidden');
            
            // Show/hide siswa specific fields
            if (role === 'siswa') {
                document.getElementById('siswaFields').classList.remove('hidden');
                document.getElementById('kelas').required = true;
                document.getElementById('jurusan').required = true;
            } else {
                document.getElementById('siswaFields').classList.add('hidden');
                document.getElementById('kelas').required = false;
                document.getElementById('jurusan').required = false;
            }
            
            resetForm();
        }

        function resetForm() {
            document.getElementById('fullName').value = '';
            document.getElementById('idNumber').value = '';
            document.getElementById('kelas').value = '';
            document.getElementById('jurusan').value = '';
            document.getElementById('attendanceType').value = '';
            hasPhoto = false;
            hasLocation = false;
            updateSubmitButton();
            
            // Reset time warning
            document.getElementById('timeWarning').classList.add('hidden');
            
            // Reset camera
            document.getElementById('camera').classList.add('hidden');
            document.getElementById('capturedPhoto').classList.add('hidden');
            document.getElementById('startCameraBtn').classList.remove('hidden');
            document.getElementById('captureBtn').classList.add('hidden');
            document.getElementById('retakeBtn').classList.add('hidden');
            
            // Reset location
            document.getElementById('locationStatus').textContent = 'Klik tombol untuk mendapatkan lokasi';
            document.getElementById('locationStatus').className = 'text-gray-600';
            document.getElementById('locationCoords').classList.add('hidden');
            document.getElementById('getLocationBtn').classList.remove('hidden');
            document.getElementById('manualLocationBtn').classList.add('hidden');
            document.getElementById('manualLocationDiv').classList.add('hidden');
            document.getElementById('locationGuide').classList.remove('hidden');
            document.getElementById('manualLocation').value = '';
        }

        function checkAttendanceTime() {
            const attendanceType = document.getElementById('attendanceType').value;
            const timeWarning = document.getElementById('timeWarning');
            const timeWarningText = document.getElementById('timeWarningText');
            
            if (!attendanceType) {
                timeWarning.classList.add('hidden');
                return;
            }
            
            const now = new Date();
            const currentTime = now.getHours() * 60 + now.getMinutes(); // Convert to minutes
            const entryTime = 7 * 60 + 15; // 07:15 in minutes
            const exitTime = 13 * 60 + 30; // 13:30 in minutes
            
            let showWarning = false;
            let warningMessage = '';
            
            if (attendanceType === 'masuk') {
                if (currentTime > entryTime) {
                    showWarning = true;
                    const lateMinutes = currentTime - entryTime;
                    const lateHours = Math.floor(lateMinutes / 60);
                    const lateRemainingMinutes = lateMinutes % 60;
                    
                    if (lateHours > 0) {
                        warningMessage = `Anda terlambat ${lateHours} jam ${lateRemainingMinutes} menit dari jam masuk (07:15). Absensi akan tercatat sebagai TERLAMBAT.`;
                    } else {
                        warningMessage = `Anda terlambat ${lateRemainingMinutes} menit dari jam masuk (07:15). Absensi akan tercatat sebagai TERLAMBAT.`;
                    }
                }
            } else if (attendanceType === 'pulang') {
                if (currentTime < exitTime) {
                    showWarning = true;
                    const earlyMinutes = exitTime - currentTime;
                    const earlyHours = Math.floor(earlyMinutes / 60);
                    const earlyRemainingMinutes = earlyMinutes % 60;
                    
                    if (earlyHours > 0) {
                        warningMessage = `Anda pulang ${earlyHours} jam ${earlyRemainingMinutes} menit lebih awal dari jam pulang (13:30). Absensi akan tercatat sebagai PULANG AWAL.`;
                    } else {
                        warningMessage = `Anda pulang ${earlyRemainingMinutes} menit lebih awal dari jam pulang (13:30). Absensi akan tercatat sebagai PULANG AWAL.`;
                    }
                }
            }
            
            if (showWarning) {
                timeWarningText.textContent = warningMessage;
                timeWarning.classList.remove('hidden');
            } else {
                timeWarning.classList.add('hidden');
            }
        }

        function getAttendanceStatus(attendanceType, timestamp) {
            const date = new Date(timestamp);
            const currentTime = date.getHours() * 60 + date.getMinutes();
            const entryTime = 7 * 60 + 15; // 07:15
            const exitTime = 13 * 60 + 30; // 13:30
            
            if (attendanceType === 'masuk') {
                return currentTime <= entryTime ? 'TEPAT WAKTU' : 'TERLAMBAT';
            } else if (attendanceType === 'pulang') {
                return currentTime >= exitTime ? 'TEPAT WAKTU' : 'PULANG AWAL';
            }
            
            return 'NORMAL';
        }

        function getStatusBadgeClass(status) {
            switch(status) {
                case 'TEPAT WAKTU': return 'bg-green-100 text-green-800';
                case 'TERLAMBAT': return 'bg-red-100 text-red-800';
                case 'PULANG AWAL': return 'bg-yellow-100 text-yellow-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        async function startCamera() {
            const startBtn = document.getElementById('startCameraBtn');
            const originalText = startBtn.innerHTML;
            
            try {
                startBtn.innerHTML = '<span>‚è≥</span><span>Membuka Kamera...</span>';
                startBtn.disabled = true;
                
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    throw new Error('Browser tidak mendukung akses kamera');
                }
                
                currentStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        width: { ideal: 640 },
                        height: { ideal: 480 },
                        facingMode: 'user'
                    } 
                });
                
                const video = document.getElementById('camera');
                video.srcObject = currentStream;
                video.classList.remove('hidden');
                
                await new Promise((resolve) => {
                    video.onloadedmetadata = resolve;
                });
                
                startBtn.classList.add('hidden');
                document.getElementById('captureBtn').classList.remove('hidden');
                
            } catch (error) {
                console.error('Camera error:', error);
                
                let errorMessage = 'Tidak dapat mengakses kamera. ';
                if (error.name === 'NotAllowedError') {
                    errorMessage += 'Izin kamera ditolak. Silakan izinkan akses kamera di browser.';
                } else if (error.name === 'NotFoundError') {
                    errorMessage += 'Kamera tidak ditemukan.';
                } else if (error.name === 'NotSupportedError') {
                    errorMessage += 'Browser tidak mendukung akses kamera.';
                } else {
                    errorMessage += error.message || 'Terjadi kesalahan tidak diketahui.';
                }
                
                alert(errorMessage);
                startBtn.innerHTML = originalText;
                startBtn.disabled = false;
            }
        }

        function capturePhoto() {
            const video = document.getElementById('camera');
            const canvas = document.getElementById('photoCanvas');
            const context = canvas.getContext('2d');
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0);
            
            const photoData = canvas.toDataURL('image/jpeg', 0.8);
            const img = document.getElementById('capturedPhoto');
            img.src = photoData;
            img.classList.remove('hidden');
            
            video.classList.add('hidden');
            document.getElementById('captureBtn').classList.add('hidden');
            document.getElementById('retakeBtn').classList.remove('hidden');
            
            hasPhoto = true;
            updateSubmitButton();
            stopCamera();
        }

        function retakePhoto() {
            document.getElementById('capturedPhoto').classList.add('hidden');
            document.getElementById('retakeBtn').classList.add('hidden');
            document.getElementById('startCameraBtn').classList.remove('hidden');
            hasPhoto = false;
            updateSubmitButton();
        }

        function stopCamera() {
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
                currentStream = null;
            }
        }

        function getLocation() {
            const statusEl = document.getElementById('locationStatus');
            const coordsEl = document.getElementById('locationCoords');
            const btnEl = document.getElementById('getLocationBtn');
            const originalBtnText = btnEl.innerHTML;
            
            if (!navigator.geolocation) {
                statusEl.textContent = 'Browser tidak mendukung geolocation';
                statusEl.className = 'text-red-600';
                showManualLocationOption();
                return;
            }
            
            statusEl.textContent = 'Mendapatkan lokasi...';
            statusEl.className = 'text-blue-600';
            btnEl.innerHTML = '<span>‚è≥</span><span>Mencari Lokasi...</span>';
            btnEl.disabled = true;
            
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    const accuracy = position.coords.accuracy;
                    
                    statusEl.textContent = '‚úÖ Lokasi GPS berhasil didapatkan';
                    statusEl.className = 'text-green-600 font-medium';
                    coordsEl.textContent = `Lat: ${lat.toFixed(6)}, Lng: ${lng.toFixed(6)} (¬±${Math.round(accuracy)}m)`;
                    coordsEl.classList.remove('hidden');
                    btnEl.classList.add('hidden');
                    document.getElementById('manualLocationBtn').classList.add('hidden');
                    document.getElementById('locationGuide').classList.add('hidden');
                    
                    hasLocation = true;
                    updateSubmitButton();
                },
                function(error) {
                    console.error('Geolocation error:', error);
                    
                    let errorMsg = 'Gagal mendapatkan lokasi GPS: ';
                    let helpText = '';
                    
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMsg += 'Izin lokasi ditolak.';
                            helpText = 'Coba refresh halaman dan klik "Allow" saat diminta izin lokasi, atau gunakan input manual di bawah.';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMsg += 'Lokasi tidak tersedia.';
                            helpText = 'Pastikan GPS aktif dan koneksi internet stabil, atau gunakan input manual.';
                            break;
                        case error.TIMEOUT:
                            errorMsg += 'Timeout.';
                            helpText = 'Coba lagi dalam beberapa saat atau gunakan input manual.';
                            break;
                        default:
                            errorMsg += 'Error tidak diketahui.';
                            helpText = 'Silakan gunakan input lokasi manual di bawah.';
                            break;
                    }
                    
                    statusEl.innerHTML = `${errorMsg}<br><small class="text-gray-600">${helpText}</small>`;
                    statusEl.className = 'text-red-600';
                    btnEl.innerHTML = originalBtnText;
                    btnEl.disabled = false;
                    
                    showManualLocationOption();
                },
                {
                    enableHighAccuracy: true,
                    timeout: 15000,
                    maximumAge: 300000
                }
            );
        }

        function showManualLocation() {
            document.getElementById('manualLocationDiv').classList.remove('hidden');
            document.getElementById('manualLocationBtn').classList.add('hidden');
        }

        function showManualLocationOption() {
            document.getElementById('manualLocationBtn').classList.remove('hidden');
        }

        function useManualLocation() {
            const manualInput = document.getElementById('manualLocation');
            const location = manualInput.value.trim();
            
            if (!location) {
                alert('Silakan masukkan lokasi terlebih dahulu');
                manualInput.focus();
                return;
            }
            
            const statusEl = document.getElementById('locationStatus');
            const coordsEl = document.getElementById('locationCoords');
            
            statusEl.textContent = '‚úÖ Lokasi manual berhasil diset';
            statusEl.className = 'text-green-600 font-medium';
            coordsEl.textContent = `Lokasi: ${location}`;
            coordsEl.classList.remove('hidden');
            
            document.getElementById('manualLocationDiv').classList.add('hidden');
            document.getElementById('getLocationBtn').classList.add('hidden');
            document.getElementById('manualLocationBtn').classList.add('hidden');
            document.getElementById('locationGuide').classList.add('hidden');
            
            hasLocation = true;
            updateSubmitButton();
        }

        function updateSubmitButton() {
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = !(hasPhoto && hasLocation);
        }

        function handleAttendance(event) {
            event.preventDefault();
            
            const attendanceType = document.getElementById('attendanceType').value;
            if (!attendanceType) {
                alert('Silakan pilih jenis absensi terlebih dahulu!');
                return;
            }
            
            // Get location text properly
            let locationText = '';
            const coordsEl = document.getElementById('locationCoords');
            const manualLocationInput = document.getElementById('manualLocation');
            
            if (coordsEl.textContent && !coordsEl.classList.contains('hidden')) {
                locationText = coordsEl.textContent;
            } else if (manualLocationInput.value) {
                locationText = `Lokasi: ${manualLocationInput.value}`;
            } else {
                locationText = 'Lokasi tidak tersedia';
            }
            
            const timestamp = new Date().toISOString();
            const status = getAttendanceStatus(attendanceType, timestamp);
            
            const formData = {
                id: Date.now(),
                timestamp: timestamp,
                role: currentRole,
                attendanceType: attendanceType,
                status: status,
                name: document.getElementById('fullName').value,
                idNumber: document.getElementById('idNumber').value,
                kelas: currentRole === 'siswa' ? document.getElementById('kelas').value : '',
                jurusan: currentRole === 'siswa' ? document.getElementById('jurusan').value : '',
                photo: document.getElementById('capturedPhoto').src,
                location: locationText,
                date: new Date().toISOString().split('T')[0]
            };
            
            // Load existing data, add new entry, and save back
            let existingData = JSON.parse(localStorage.getItem('attendanceData')) || [];
            existingData.push(formData);
            localStorage.setItem('attendanceData', JSON.stringify(existingData));
            
            // Update global variable
            attendanceData = existingData;
            
            // Show success message with details
            const attendanceTypeText = attendanceType === 'masuk' ? 'MASUK' : 'PULANG';
            const successMsg = `‚úÖ Absensi ${attendanceTypeText} berhasil disimpan!\n\nDetail:\n- Nama: ${formData.name}\n- Role: ${formData.role.toUpperCase()}\n- Jenis: ${attendanceTypeText}\n- Status: ${status}\n- Waktu: ${new Date(formData.timestamp).toLocaleString('id-ID')}\n- Lokasi: ${locationText}`;
            alert(successMsg);
            
            backToAttendanceMenu();
            
            // Update stats if admin is logged in
            if (!document.getElementById('adminDashboard').classList.contains('hidden')) {
                updateStats();
                renderAttendanceTable();
            }
        }

        function updateStats() {
            const today = new Date().toISOString().split('T')[0];
            const todayData = attendanceData.filter(item => item.date === today);
            
            document.getElementById('totalToday').textContent = todayData.length;
            document.getElementById('guruHadir').textContent = todayData.filter(item => item.role === 'guru').length;
            document.getElementById('karyawanHadir').textContent = todayData.filter(item => item.role === 'karyawan').length;
            document.getElementById('siswaHadir').textContent = todayData.filter(item => item.role === 'siswa').length;
            document.getElementById('activeExams').textContent = examData.filter(exam => exam.status === 'active').length;
        }

        function renderAttendanceTable() {
            const tbody = document.getElementById('attendanceTable');
            const filteredData = getFilteredData();
            
            tbody.innerHTML = '';
            
            if (filteredData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" class="px-4 py-8 text-center text-gray-500">
                            <div class="flex flex-col items-center space-y-2">
                                <span class="text-4xl">üìã</span>
                                <span>Belum ada data absensi</span>
                                <span class="text-sm">Data akan muncul setelah ada yang melakukan absensi</span>
                            </div>
                        </td>
                    </tr>
                `;
            } else {
                filteredData.forEach(item => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50';
                    
                    const time = new Date(item.timestamp).toLocaleString('id-ID');
                    const kelasJurusan = item.role === 'siswa' ? `${item.kelas} - ${item.jurusan}` : '-';
                    const attendanceTypeText = item.attendanceType === 'masuk' ? 'Masuk' : 'Pulang';
                    const status = item.status || 'NORMAL';
                    
                    row.innerHTML = `
                        <td class="px-4 py-3 text-sm text-gray-900">${time}</td>
                        <td class="px-4 py-3 text-sm font-medium text-gray-900">${item.name}</td>
                        <td class="px-4 py-3">
                            <span class="px-2 py-1 text-xs font-medium rounded-full ${getRoleBadgeClass(item.role)}">
                                ${item.role.charAt(0).toUpperCase() + item.role.slice(1)}
                            </span>
                        </td>
                        <td class="px-4 py-3">
                            <span class="px-2 py-1 text-xs font-medium rounded-full ${item.attendanceType === 'masuk' ? 'bg-blue-100 text-blue-800' : 'bg-orange-100 text-orange-800'}">
                                ${attendanceTypeText}
                            </span>
                        </td>
                        <td class="px-4 py-3">
                            <span class="px-2 py-1 text-xs font-medium rounded-full ${getStatusBadgeClass(status)}">
                                ${status}
                            </span>
                        </td>
                        <td class="px-4 py-3 text-sm text-gray-900">${item.idNumber}</td>
                        <td class="px-4 py-3 text-sm text-gray-900">${kelasJurusan}</td>
                        <td class="px-4 py-3 text-sm text-gray-600">${item.location}</td>
                        <td class="px-4 py-3">
                            <button onclick="showPhoto('${item.photo}')" class="text-blue-600 hover:text-blue-800 text-sm">
                                Lihat Foto
                            </button>
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                });
            }
            
            // Update last refresh timestamp
            updateLastRefreshTime();
        }

        function refreshData() {
            // Reload data from localStorage
            attendanceData = JSON.parse(localStorage.getItem('attendanceData')) || [];
            examData = JSON.parse(localStorage.getItem('examData')) || [];
            examResults = JSON.parse(localStorage.getItem('examResults')) || [];
            
            // Update all displays
            updateStats();
            renderAttendanceTable();
            renderExamManagementTable();
            
            // Show refresh animation
            const refreshBtn = event.target.closest('button');
            const originalContent = refreshBtn.innerHTML;
            refreshBtn.innerHTML = '<span class="animate-spin">üîÑ</span><span>Memuat...</span>';
            refreshBtn.disabled = true;
            
            setTimeout(() => {
                refreshBtn.innerHTML = originalContent;
                refreshBtn.disabled = false;
            }, 1000);
            
            console.log('Data refreshed:', {
                attendance: attendanceData.length,
                exams: examData.length,
                results: examResults.length
            });
        }

        function updateLastRefreshTime() {
            const now = new Date().toLocaleTimeString('id-ID');
            const lastUpdateEl = document.getElementById('lastUpdate');
            if (lastUpdateEl) {
                lastUpdateEl.textContent = `Terakhir diperbarui: ${now}`;
            }
        }

        function getRoleBadgeClass(role) {
            switch(role) {
                case 'guru': return 'bg-green-100 text-green-800';
                case 'karyawan': return 'bg-blue-100 text-blue-800';
                case 'siswa': return 'bg-purple-100 text-purple-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function showPhoto(photoSrc) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="max-w-2xl max-h-full p-4">
                    <img src="${photoSrc}" class="max-w-full max-h-full rounded-lg shadow-lg" alt="Foto Absensi">
                    <button onclick="this.parentElement.parentElement.remove()" class="absolute top-4 right-4 text-white text-2xl hover:text-gray-300">
                        ‚úï
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function getFilteredData() {
            let filtered = [...attendanceData];
            
            const roleFilter = document.getElementById('filterRole').value;
            const typeFilter = document.getElementById('filterType').value;
            const dateFromFilter = document.getElementById('filterDateFrom').value;
            const dateToFilter = document.getElementById('filterDateTo').value;
            
            if (roleFilter) {
                filtered = filtered.filter(item => item.role === roleFilter);
            }
            
            if (typeFilter) {
                filtered = filtered.filter(item => item.attendanceType === typeFilter);
            }
            
            if (dateFromFilter) {
                filtered = filtered.filter(item => item.date >= dateFromFilter);
            }
            
            if (dateToFilter) {
                filtered = filtered.filter(item => item.date <= dateToFilter);
            }
            
            return filtered.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        }

        function filterData() {
            renderAttendanceTable();
        }

        function resetFilters() {
            document.getElementById('filterRole').value = '';
            document.getElementById('filterType').value = '';
            document.getElementById('filterDateFrom').value = '';
            document.getElementById('filterDateTo').value = '';
            renderAttendanceTable();
        }

        function exportToCSV() {
            const data = getFilteredData();
            if (data.length === 0) {
                alert('Tidak ada data untuk diekspor');
                return;
            }
            
            const headers = ['Waktu', 'Nama', 'Role', 'Jenis', 'Status', 'NIP/NIS', 'Kelas', 'Jurusan', 'Lokasi'];
            const csvContent = [
                headers.join(','),
                ...data.map(item => [
                    `"${new Date(item.timestamp).toLocaleString('id-ID')}"`,
                    `"${item.name}"`,
                    `"${item.role}"`,
                    `"${item.attendanceType === 'masuk' ? 'Masuk' : 'Pulang'}"`,
                    `"${item.status || 'NORMAL'}"`,
                    `"${item.idNumber}"`,
                    `"${item.kelas || '-'}"`,
                    `"${item.jurusan || '-'}"`,
                    `"${item.location}"`
                ].join(','))
            ].join('\n');
            
            downloadFile(csvContent, 'absensi.csv', 'text/csv');
        }

        function exportToExcel() {
            const data = getFilteredData();
            if (data.length === 0) {
                alert('Tidak ada data untuk diekspor');
                return;
            }
            
            let html = `
                <table border="1">
                    <tr>
                        <th>Waktu</th>
                        <th>Nama</th>
                        <th>Role</th>
                        <th>Jenis</th>
                        <th>Status</th>
                        <th>NIP/NIS</th>
                        <th>Kelas</th>
                        <th>Jurusan</th>
                        <th>Lokasi</th>
                    </tr>
            `;
            
            data.forEach(item => {
                html += `
                    <tr>
                        <td>${new Date(item.timestamp).toLocaleString('id-ID')}</td>
                        <td>${item.name}</td>
                        <td>${item.role}</td>
                        <td>${item.attendanceType === 'masuk' ? 'Masuk' : 'Pulang'}</td>
                        <td>${item.status || 'NORMAL'}</td>
                        <td>${item.idNumber}</td>
                        <td>${item.kelas || '-'}</td>
                        <td>${item.jurusan || '-'}</td>
                        <td>${item.location}</td>
                    </tr>
                `;
            });
            
            html += '</table>';
            
            downloadFile(html, 'absensi.xls', 'application/vnd.ms-excel');
        }

        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'984f42c5d70dfe01',t:'MTc1ODg1MzAwMy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
